import{b as u,j as e,u as j,a as f,L as y,n as i}from"./index-JCKDIzil.js";import{r as N}from"./react-vendor-BXWpoY3z.js";import{u as v}from"./useQuery-CRcodGZg.js";import{u as p}from"./useMutation-ra1mZCKk.js";import{X as w,x as D}from"./ui-vendor-LNFcJBPj.js";const k=async()=>{const{data:t}=await u.get("/accounts/users/");return t},U=async(t,a)=>{const{data:r}=await u.patch(`/accounts/users/${t}/assign_role/`,{role:a});return r},C=async t=>{await u.delete(`/accounts/users/${t}/`)},S=({isOpen:t,onClose:a,onConfirm:r,title:n,message:d,confirmText:c="Confirm",cancelText:o="Cancel",isDangerous:x=!1})=>{if(!t)return null;const m=()=>{r(),a()};return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:a}),e.jsxs("div",{className:"relative bg-slate-800 rounded-2xl shadow-2xl border border-white/10 max-w-md w-full mx-4 overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 border-b border-white/10",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:n}),e.jsx("button",{onClick:a,className:"text-slate-400 hover:text-white transition-colors",children:e.jsx(w,{className:"h-5 w-5"})})]})}),e.jsx("div",{className:"px-6 py-6",children:e.jsx("p",{className:"text-slate-300 leading-relaxed",children:d})}),e.jsxs("div",{className:"px-6 py-4 bg-slate-900/50 flex gap-3 justify-end",children:[e.jsx("button",{onClick:a,className:"px-4 py-2 rounded-lg text-sm font-medium text-slate-300 hover:text-white hover:bg-white/5 transition-all",children:o}),e.jsx("button",{onClick:m,className:`px-4 py-2 rounded-lg text-sm font-medium transition-all ${x?"bg-red-500 hover:bg-red-600 text-white shadow-lg shadow-red-500/20":"bg-brand-500 hover:bg-brand-600 text-white shadow-lg shadow-brand-500/20"}`,children:c})]})]})]})},M=()=>{const[t,a]=N.useState({isOpen:!1,userId:null,userName:""}),{user:r}=j(),n=f(),{data:d=[],isLoading:c}=v({queryKey:["admin-users"],queryFn:k,staleTime:30*1e3,gcTime:5*60*1e3}),o=p({mutationFn:({userId:s,newRole:l})=>U(s,l),onSuccess:(s,l)=>{i.success(`User role updated to ${l.newRole}`),n.invalidateQueries({queryKey:["admin-users"]})},onError:()=>{i.error("Failed to update user role")}}),x=(s,l)=>{o.mutate({userId:s,newRole:l})},m=(s,l)=>{a({isOpen:!0,userId:s,userName:l})},h=()=>{a({isOpen:!1,userId:null,userName:""})},b=p({mutationFn:C,onSuccess:()=>{i.success("User deleted successfully"),n.invalidateQueries({queryKey:["admin-users"]}),h()},onError:()=>{i.error("Failed to delete user")}}),g=()=>{t.userId&&b.mutate(t.userId)};return c?e.jsx(y,{label:"Loading users"}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.4em] text-brand-500 dark:text-brand-300",children:"Admin"}),e.jsx("h1",{className:"mt-2 text-3xl font-bold text-slate-900 dark:text-white",children:"User Management"})]}),e.jsx("div",{className:"card overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left text-sm text-slate-600 dark:text-slate-400",children:[e.jsx("thead",{className:"bg-slate-100 text-xs uppercase text-slate-600 dark:bg-slate-900/50 dark:text-slate-400",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3",children:"User"}),e.jsx("th",{className:"px-6 py-3",children:"Status"}),e.jsx("th",{className:"px-6 py-3",children:"Type"}),e.jsx("th",{className:"px-6 py-3",children:"Role"}),e.jsx("th",{className:"px-6 py-3",children:"Joined"}),e.jsx("th",{className:"px-6 py-3 text-right",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-200 dark:divide-white/5",children:d.map(s=>e.jsxs("tr",{className:"hover:bg-slate-50 dark:hover:bg-white/5",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"h-10 w-10 flex-shrink-0 rounded-full bg-brand-500/20 flex items-center justify-center text-brand-400 font-bold",children:s.name.charAt(0).toUpperCase()}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"font-bold text-slate-900 dark:text-white",children:s.name}),e.jsx("div",{className:"text-slate-500",children:s.email})]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("span",{className:`inline-flex items-center rounded-full px-2 py-0.5 text-xs font-medium ${s.is_online?"bg-green-500/20 text-green-300":"bg-gray-500/20 text-gray-400"}`,children:[e.jsx("span",{className:`mr-1.5 h-2 w-2 rounded-full ${s.is_online?"bg-green-500":"bg-gray-500"}`}),s.is_online?"Online":"Offline"]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium ${s.user_type==="Student"?"bg-blue-500/20 text-blue-300":s.user_type==="Staff"?"bg-emerald-500/20 text-emerald-300":"bg-amber-500/20 text-amber-300"}`,children:s.user_type||"Visitor"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("select",{value:s.role,onChange:l=>x(s.id,l.target.value),disabled:s.id===r?.id,className:`rounded-full px-3 py-1 text-xs font-semibold leading-5 border-0 cursor-pointer ${s.role==="ADMIN"?"bg-purple-500/20 text-purple-300":"bg-orange-500/20 text-orange-300"} disabled:opacity-50 disabled:cursor-not-allowed`,children:[e.jsx("option",{value:"ADMIN",children:"ADMIN"}),e.jsx("option",{value:"USER",children:"USER"})]})}),e.jsx("td",{className:"px-6 py-4",children:s.created_at?new Date(s.created_at).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"N/A"}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsx("button",{onClick:()=>m(s.id,s.name),className:"p-2 text-slate-400 hover:text-red-400 transition-colors",title:"Delete User",disabled:s.id===r?.id,children:e.jsx(D,{className:"h-5 w-5"})})})]},s.id))})]})})}),e.jsx(S,{isOpen:t.isOpen,onClose:h,onConfirm:g,title:"Delete User",message:`Are you sure you want to delete ${t.userName}? This action cannot be undone.`,confirmText:"Delete",cancelText:"Cancel",isDangerous:!0})]})};export{M as default};
