import{u as D,j as e,a as W,L as E,k as R}from"./index-JCKDIzil.js";import{r as d,e as K,L as S,f as F}from"./react-vendor-BXWpoY3z.js";import{u as O}from"./useQuery-CRcodGZg.js";import{u as B}from"./useMutation-ra1mZCKk.js";import{t as H,b as U,a as G}from"./catalog-C1220ciI.js";import{u as P}from"./useSubscription-CDB9kPPG.js";import{S as Q}from"./SubscriptionPaywall-BRDFXm4Y.js";import"./ui-vendor-LNFcJBPj.js";import"./subscriptions-C6OQrZG9.js";const $=d.memo(({book:t,viewMode:j,onLike:r,onBookmark:x})=>{const h=D(s=>s.user),b=K(),{needsSubscription:k,isLoading:w}=P(),[l,v]=d.useState(!1),[u,y]=d.useState(""),c=s=>!w&&k?(y(s==="view"?"view book details":"read books"),v(!0),!0):!1,p=s=>{if(c("view")){s.preventDefault();return}},o=s=>{s.preventDefault(),c("read")||b(`/reader/${t.id}`)};return e.jsxs(e.Fragment,{children:[j==="grid"?e.jsxs("div",{className:"card flex flex-col gap-3 p-4",children:[e.jsx("div",{className:"aspect-square w-full overflow-hidden rounded-lg bg-slate-200 dark:bg-slate-800",children:t.cover_image?e.jsx("img",{src:t.cover_image,alt:t.title,className:"h-full w-full object-cover transition duration-300 hover:scale-105",loading:"lazy"}):e.jsx("div",{className:"flex h-full w-full items-center justify-center text-xs text-slate-400 dark:text-slate-600",children:"No Cover"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-brand-600 dark:text-brand-300",children:t.author}),e.jsx("h3",{className:"mt-1 text-base font-semibold text-slate-900 dark:text-white line-clamp-2",children:t.title}),e.jsx("p",{className:"mt-1 line-clamp-2 text-xs text-slate-600 dark:text-slate-400",children:t.description})]}),e.jsxs("div",{className:"flex items-center gap-2 text-[10px]",children:[e.jsx("span",{className:"rounded bg-slate-100 px-1.5 py-0.5 font-medium text-slate-600 dark:bg-slate-800 dark:text-slate-300",children:t.language}),e.jsx("span",{className:"rounded bg-rose-100 px-1.5 py-0.5 font-medium text-rose-600 dark:bg-rose-500/10 dark:text-rose-300",children:t.file_type}),t.reading_progress&&e.jsxs("span",{className:"ml-auto text-brand-600 dark:text-brand-200",children:[Math.round(t.reading_progress.percent),"%"]})]}),e.jsx("div",{className:"flex flex-wrap gap-1.5 text-[10px]",children:Array.isArray(t.tags)?t.tags.slice(0,3).map(s=>e.jsxs("span",{className:`rounded-full px-2 py-0.5 font-medium ${s.toLowerCase()==="new"?"bg-brand-100 text-brand-700 dark:bg-brand-500/20 dark:text-brand-300":"bg-slate-100 text-slate-600 dark:bg-slate-800 dark:text-slate-400"}`,children:["#",s]},s)):null}),e.jsxs("div",{className:"mt-auto flex flex-col gap-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(S,{to:`/catalog/${t.id}`,onClick:p,className:"flex-1 rounded-lg border border-slate-300 px-3 py-1.5 text-center text-xs font-semibold text-slate-700 transition hover:bg-slate-100 dark:border-white/10 dark:text-white dark:hover:border-brand-500 dark:hover:bg-white/5",children:"View"}),e.jsx("button",{onClick:o,className:"btn-gradient-blue flex-1 px-3 py-1.5 text-center text-xs font-semibold rounded-lg",children:"Read"})]}),h&&e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx("button",{onClick:()=>r(t.id),className:`btn-icon ${t.is_liked?"text-red-500":"text-slate-400 hover:text-red-500"}`,title:t.is_liked?"Unlike":"Like",children:e.jsx("svg",{className:"h-6 w-6",fill:t.is_liked?"currentColor":"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"})})}),e.jsx("button",{onClick:()=>x(t.id),className:`btn-icon ${t.is_bookmarked?"text-blue-500":"text-slate-400 hover:text-blue-500"}`,title:t.is_bookmarked?"Remove bookmark":"Bookmark",children:e.jsx("svg",{className:"h-6 w-6",fill:t.is_bookmarked?"currentColor":"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"})})})]})]})]}):e.jsxs("div",{className:"card flex gap-4 p-4",children:[e.jsx("div",{className:"h-32 w-24 flex-shrink-0 overflow-hidden rounded-lg bg-slate-200 dark:bg-slate-800",children:t.cover_image?e.jsx("img",{src:t.cover_image,alt:t.title,className:"h-full w-full object-cover",loading:"lazy"}):e.jsx("div",{className:"flex h-full w-full items-center justify-center text-xs text-slate-400 dark:text-slate-600",children:"No Cover"})}),e.jsxs("div",{className:"flex flex-1 flex-col gap-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-brand-600 dark:text-brand-300",children:t.author}),e.jsx("h3",{className:"mt-1 text-lg font-semibold text-slate-900 dark:text-white",children:t.title}),e.jsx("p",{className:"mt-1 line-clamp-2 text-sm text-slate-600 dark:text-slate-400",children:t.description})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx("span",{className:"rounded bg-slate-100 px-2 py-0.5 font-medium text-slate-600 dark:bg-slate-800 dark:text-slate-300",children:t.language}),e.jsx("span",{className:"rounded bg-rose-100 px-2 py-0.5 font-medium text-rose-600 dark:bg-rose-500/10 dark:text-rose-300",children:t.file_type}),t.reading_progress&&e.jsxs("span",{className:"ml-auto text-brand-600 dark:text-brand-200",children:[Math.round(t.reading_progress.percent),"%"]})]}),e.jsx("div",{className:"flex flex-wrap gap-1.5 text-xs",children:Array.isArray(t.tags)?t.tags.slice(0,5).map(s=>e.jsxs("span",{className:`rounded-full px-2.5 py-0.5 font-medium ${s.toLowerCase()==="new"?"bg-brand-100 text-brand-700 dark:bg-brand-500/20 dark:text-brand-300":"bg-slate-100 text-slate-600 dark:bg-slate-800 dark:text-slate-400"}`,children:["#",s]},s)):null}),e.jsxs("div",{className:"mt-auto flex items-center gap-3",children:[e.jsx(S,{to:`/catalog/${t.id}`,onClick:p,className:"rounded-lg border border-slate-300 px-4 py-2 text-sm font-semibold text-slate-700 transition hover:bg-slate-100 dark:border-white/10 dark:text-white dark:hover:bg-white/5",children:"View Details"}),e.jsx("button",{onClick:o,className:"btn-gradient-blue px-4 py-2 text-sm opacity-100 visible",style:{opacity:1,visibility:"visible"},children:"Read Now"}),h&&e.jsxs("div",{className:"ml-auto flex items-center gap-3",children:[e.jsx("button",{onClick:()=>r(t.id),className:`btn-icon ${t.is_liked?"text-red-500":"text-slate-400 hover:text-red-500"}`,title:t.is_liked?"Unlike":"Like",children:e.jsx("svg",{className:"h-6 w-6",fill:t.is_liked?"currentColor":"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"})})}),e.jsx("button",{onClick:()=>x(t.id),className:`btn-icon ${t.is_bookmarked?"text-blue-500":"text-slate-400 hover:text-blue-500"}`,title:t.is_bookmarked?"Remove bookmark":"Bookmark",children:e.jsx("svg",{className:"h-6 w-6",fill:t.is_bookmarked?"currentColor":"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"})})})]})]})]})]}),e.jsx(Q,{isOpen:l,onClose:()=>v(!1),actionBlocked:u})]})});$.displayName="BookCard";const re=()=>{const[t,j]=d.useState(""),[r,x]=d.useState(1),[h,b]=F(),k=h.get("categoryId"),w=h.get("categoryName")??"",[l,v]=d.useState(k?Number(k):void 0),[u,y]=d.useState(w),[c,p]=d.useState(()=>localStorage.getItem("catalogViewMode")||"grid"),o=W();D(a=>a.user);const{needsSubscription:s,isLoading:f}=P(),[z,N]=d.useState(!1),[A,L]=d.useState(""),{data:m,isLoading:V}=O({queryKey:["books",{search:t,page:r,categoryId:l}],queryFn:()=>G({page:r,query:t,categories__id:l}),placeholderData:R,staleTime:5*60*1e3}),_=B({mutationFn:a=>H(a),onMutate:async a=>{await o.cancelQueries({queryKey:["books"]});const g=o.getQueryData(["books",{search:t,page:r,categoryId:l}]);return o.setQueryData(["books",{search:t,page:r,categoryId:l}],i=>i&&{...i,results:i.results.map(n=>n.id===a?{...n,is_liked:!n.is_liked,like_count:n.is_liked?n.like_count-1:n.like_count+1}:n)}),{previousData:g}},onError:(a,g,i)=>{i?.previousData&&o.setQueryData(["books",{search:t,page:r,categoryId:l}],i.previousData)},onSettled:()=>{o.invalidateQueries({queryKey:["books"]})}}),M=B({mutationFn:a=>U(a),onMutate:async a=>{await o.cancelQueries({queryKey:["books"]});const g=o.getQueryData(["books",{search:t,page:r,categoryId:l}]);return o.setQueryData(["books",{search:t,page:r,categoryId:l}],i=>i&&{...i,results:i.results.map(n=>n.id===a?{...n,is_bookmarked:!n.is_bookmarked,bookmark_count:n.is_bookmarked?n.bookmark_count-1:n.bookmark_count+1}:n)}),{previousData:g}},onError:(a,g,i)=>{i?.previousData&&o.setQueryData(["books",{search:t,page:r,categoryId:l}],i.previousData)},onSettled:()=>{o.invalidateQueries({queryKey:["books"]})}}),q=d.useCallback(a=>{if(!f&&s){L("like books"),N(!0);return}_.mutate(a)},[_,s,f]),I=d.useCallback(a=>{if(!f&&s){L("bookmark books"),N(!0);return}M.mutate(a)},[M,s,f]),C=d.useMemo(()=>m?.count?Math.ceil(m.count/20):1,[m]);return d.useEffect(()=>{localStorage.setItem("catalogViewMode",c)},[c]),d.useEffect(()=>{const a={};t&&(a.search=t),r!==1&&(a.page=String(r)),l&&(a.categoryId=String(l),u&&(a.categoryName=u)),b(a,{replace:!0})},[t,r,l,u,b]),e.jsxs("div",{className:"space-y-8 animate-in",children:[e.jsxs("header",{className:"flex flex-col gap-6 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{className:"page-header mb-0",children:[e.jsx("h1",{className:"page-title",children:"Catalog"}),e.jsx("p",{className:"page-subtitle",children:"Search, filter, and discover books instantly"})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs("div",{className:"relative flex-1 md:w-80",children:[e.jsx("div",{className:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-4",children:e.jsx("svg",{className:"h-5 w-5 text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{type:"search",placeholder:"Search by title, author, or tagâ€¦",value:t,onChange:a=>{j(a.target.value),x(1)},className:"input-modern pl-11"})]}),e.jsxs("div",{className:"flex gap-2 rounded-xl border-2 border-slate-300 bg-white p-1 dark:border-white/10 dark:bg-slate-900",children:[e.jsx("button",{onClick:()=>p("grid"),className:`rounded-lg px-4 py-2.5 text-sm font-medium transition-all ${c==="grid"?"bg-brand-500 text-white shadow-md":"text-slate-600 hover:bg-slate-100 dark:text-slate-400 dark:hover:bg-white/5"}`,title:"Grid view",children:e.jsx("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"})})}),e.jsx("button",{onClick:()=>p("list"),className:`rounded-lg px-4 py-2.5 text-sm font-medium transition-all ${c==="list"?"bg-brand-500 text-white shadow-md":"text-slate-600 hover:bg-slate-100 dark:text-slate-400 dark:hover:bg-white/5"}`,title:"List view",children:e.jsx("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})})]})]})]}),m&&e.jsxs("div",{className:"space-y-2 text-sm text-slate-600 dark:text-slate-400",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold text-slate-900 dark:text-white",children:m.count.toLocaleString()})," ","books found",t&&e.jsxs("span",{className:"ml-1",children:["for ",e.jsxs("span",{className:"font-semibold text-brand-600 dark:text-brand-400",children:['"',t,'"']})]})]}),l&&e.jsxs("div",{className:"inline-flex items-center gap-2 rounded-full bg-brand-50 px-3 py-1 text-xs font-semibold text-brand-700 dark:bg-brand-500/10 dark:text-brand-300",children:[e.jsxs("span",{children:["Category: ",u||`#${l}`]}),e.jsx("button",{type:"button",onClick:()=>{v(void 0),y(""),x(1)},className:"rounded-full bg-brand-100 px-2 py-0.5 text-[10px] uppercase tracking-wide hover:bg-brand-200 dark:bg-brand-500/30 dark:hover:bg-brand-500/40",children:"Clear"})]})]}),V&&e.jsx(E,{label:"Loading books"}),e.jsx("div",{className:c==="grid"?"grid gap-6 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4":"space-y-4",children:m?.results.map(a=>e.jsx($,{book:a,viewMode:c,onLike:q,onBookmark:I},a.id))}),e.jsxs("div",{className:"flex items-center justify-between border-t border-slate-200 pt-6 dark:border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-600 dark:text-slate-400",children:[e.jsx("span",{children:"Page"}),e.jsx("span",{className:"font-semibold text-slate-900 dark:text-white",children:r}),e.jsx("span",{children:"of"}),e.jsx("span",{className:"font-semibold text-slate-900 dark:text-white",children:C})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>x(a=>Math.max(a-1,1)),disabled:r===1,className:"inline-flex items-center gap-2 rounded-xl border-2 border-slate-300 bg-white px-5 py-2.5 text-sm font-semibold text-slate-700 shadow-md transition-all hover:border-brand-400 hover:bg-brand-50 hover:text-brand-700 disabled:opacity-40 disabled:hover:border-slate-300 disabled:hover:bg-white disabled:hover:text-slate-700 dark:border-white/20 dark:bg-slate-800 dark:text-white dark:hover:bg-slate-700",children:[e.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Previous"]}),e.jsxs("button",{onClick:()=>x(a=>Math.min(a+1,C)),disabled:r===C,className:"inline-flex items-center gap-2 rounded-xl border-2 border-slate-300 bg-white px-5 py-2.5 text-sm font-semibold text-slate-700 shadow-md transition-all hover:border-brand-400 hover:bg-brand-50 hover:text-brand-700 disabled:opacity-40 disabled:hover:border-slate-300 disabled:hover:bg-white disabled:hover:text-slate-700 dark:border-white/20 dark:bg-slate-800 dark:text-white dark:hover:bg-slate-700",children:["Next",e.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})]})]}),e.jsx(Q,{isOpen:z,onClose:()=>N(!1),actionBlocked:A})]})};export{re as default};
