import{j as e,z as m}from"./index-BrKjOGpc.js";import{h as f,e as y,r as i,L as g}from"./react-vendor-BXWpoY3z.js";import{u as N}from"./useQuery-BaEuwe5n.js";import{u as j}from"./useMutation-DBZgN-6u.js";import{c as w,a as k}from"./subscriptions-CKR5TxXt.js";import{d as v,u as P,i as M,t as T}from"./ui-vendor-DIXPZkrp.js";const R=()=>{const{planId:n,provider:x}=f(),u=y(),[a,p]=i.useState(""),[l,d]=i.useState(x?.toUpperCase()||"MTN"),[t,o]=i.useState("input"),{data:c}=N({queryKey:["subscription-plans"],queryFn:k,staleTime:5*60*1e3,gcTime:10*60*1e3}),s=(Array.isArray(c)?c:[]).find(r=>r.id===Number(n)),b=j({mutationFn:w,onSuccess:()=>{o("success"),setTimeout(()=>u("/"),3e3)},onError:()=>{m.error("Payment failed. Please try again."),o("input")}}),h=r=>{if(r.preventDefault(),!a||a.length<10){m.error("Please enter a valid phone number");return}o("processing"),setTimeout(()=>{b.mutate({plan_id:Number(n),payment_method:l==="MTN"?"MM":"AIRTEL"})},2e3)};return t==="success"?e.jsxs("div",{className:"mx-auto max-w-md py-16 text-center animate-in",children:[e.jsx("div",{className:"mx-auto mb-6 flex h-20 w-20 items-center justify-center rounded-full bg-emerald-100 dark:bg-emerald-500/20",children:e.jsx(v,{className:"h-10 w-10 text-emerald-600 dark:text-emerald-400"})}),e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:"Payment Successful!"}),e.jsxs("p",{className:"mt-2 text-slate-600 dark:text-slate-400",children:["Your ",s?.name," subscription is now active. Redirecting..."]})]}):e.jsxs("div",{className:"mx-auto max-w-md space-y-6 py-8 animate-in",children:[e.jsxs(g,{to:`/subscription/payment/${n}`,className:"inline-flex items-center gap-2 text-sm font-medium text-slate-600 hover:text-brand-600 dark:text-slate-400",children:[e.jsx(P,{className:"h-4 w-4"}),"Back to payment options"]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-2xl bg-gradient-to-br from-yellow-400 to-yellow-500",children:e.jsx(M,{className:"h-8 w-8 text-white"})}),e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:"Mobile Money Payment"}),e.jsxs("p",{className:"mt-2 text-slate-600 dark:text-slate-400",children:["Pay UGX ",s?Number(s.price).toLocaleString():"---"," for ",s?.name]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>d("MTN"),disabled:t==="processing",className:`flex flex-col items-center gap-2 rounded-xl border-2 p-4 transition ${l==="MTN"?"border-yellow-500 bg-yellow-50 dark:bg-yellow-500/10":"border-slate-200 hover:border-slate-300 dark:border-white/10"}`,children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-yellow-500 flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold text-sm",children:"MTN"})}),e.jsx("span",{className:"text-sm font-medium text-slate-900 dark:text-white",children:"MTN MoMo"})]}),e.jsxs("button",{type:"button",onClick:()=>d("AIRTEL"),disabled:t==="processing",className:`flex flex-col items-center gap-2 rounded-xl border-2 p-4 transition ${l==="AIRTEL"?"border-red-500 bg-red-50 dark:bg-red-500/10":"border-slate-200 hover:border-slate-300 dark:border-white/10"}`,children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-red-500 flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold text-xs",children:"Airtel"})}),e.jsx("span",{className:"text-sm font-medium text-slate-900 dark:text-white",children:"Airtel Money"})]})]}),e.jsxs("form",{onSubmit:h,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Phone Number"}),e.jsxs("div",{className:"flex",children:[e.jsx("span",{className:"inline-flex items-center rounded-l-xl border border-r-0 border-slate-300 bg-slate-50 px-3 text-sm text-slate-600 dark:border-white/10 dark:bg-slate-800 dark:text-slate-400",children:"+256"}),e.jsx("input",{type:"tel",value:a,onChange:r=>p(r.target.value.replace(/\D/g,"")),placeholder:"7XX XXX XXX",disabled:t==="processing",className:"flex-1 rounded-r-xl border border-slate-300 px-4 py-3 text-slate-900 placeholder:text-slate-400 focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20 dark:border-white/10 dark:bg-slate-900 dark:text-white disabled:opacity-50"})]}),e.jsx("p",{className:"mt-2 text-xs text-slate-500 dark:text-slate-400",children:"You will receive a payment prompt on your phone"})]}),e.jsx("button",{type:"submit",disabled:t==="processing"||!a,className:"w-full rounded-xl bg-gradient-to-r from-brand-500 to-brand-600 py-3 font-semibold text-white shadow-lg transition hover:shadow-xl disabled:opacity-50 flex items-center justify-center gap-2",children:t==="processing"?e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"h-5 w-5 animate-spin"}),"Processing..."]}):`Pay UGX ${s?Number(s.price).toLocaleString():"---"}`})]}),t==="processing"&&e.jsx("div",{className:"rounded-xl bg-blue-50 p-4 text-center dark:bg-blue-500/10",children:e.jsxs("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:["Check your phone for the ",l," payment prompt and enter your PIN to complete payment."]})})]})};export{R as default};
