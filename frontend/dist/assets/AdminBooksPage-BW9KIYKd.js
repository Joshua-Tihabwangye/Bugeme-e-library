import{j as e,a as N,L as v,z as x}from"./index-JCKDIzil.js";import{r as f}from"./react-vendor-BXWpoY3z.js";import{u as _}from"./useQuery-CRcodGZg.js";import{u as g}from"./useMutation-ra1mZCKk.js";import{d as B,e as E,u as S,a as F}from"./catalog-C1220ciI.js";import{u as P,t as T,o as C,a as j,s as o,b as D,e as q,p as k,n as y}from"./types-BXF7fmc6.js";import{I as A,J as Q}from"./ui-vendor-LNFcJBPj.js";const I=C({title:o().min(2),author_name:o().min(2),description:o().min(10),isbn:o().min(5),language:o().default("English"),year:k(s=>s===""?void 0:Number(s),y().optional()),pages:k(s=>s===""?void 0:Number(s),y().optional()),file_type:q(["PDF","EPUB","VIDEO"]),is_published:D().default(!0),tags:o().optional(),category_names:o().optional(),cover_image:j().optional(),file:j().optional()}),O=({defaultValues:s,onSubmit:m,isLoading:b})=>{const{register:t,handleSubmit:c,watch:h,formState:{errors:l}}=P({resolver:T(I),defaultValues:{title:s?.title??"",author_name:s?.author_name??"",description:s?.description??"",isbn:s?.isbn??"",language:s?.language??"English",year:s?.year,pages:s?.pages,file_type:s?.file_type??"PDF",is_published:s?.is_published??!0,tags:Array.isArray(s?.tags)?s.tags.join(", "):s?.tags||"",category_names:Array.isArray(s?.category_names)?s.category_names.join(", "):s?.category_names||""}}),p=c(async u=>{const n=new FormData;Object.entries(u).forEach(([d,r])=>{if(!(r==null||r===""))if(d==="tags"){if(typeof r=="string"){const i=r.split(",").map(a=>a.trim()).filter(Boolean);n.append("tags",JSON.stringify(i))}}else if(d==="category_names")typeof r=="string"&&r.split(",").map(i=>i.trim()).filter(Boolean).forEach(i=>n.append("category_names",i));else if(d==="cover_image"||d==="file"){const i=r;i?.length&&n.append(d,i[0])}else n.append(d,String(r))}),await m(n)});return e.jsxs("form",{onSubmit:p,className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold text-slate-700 dark:text-slate-400",children:"Title"}),e.jsx("input",{...t("title"),className:"mt-2 w-full rounded-lg border border-slate-300 bg-white px-4 py-2 text-sm text-slate-900 placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-brand-500 dark:border-white/10 dark:bg-slate-900 dark:text-white"}),l.title&&e.jsx("p",{className:"text-xs text-red-400",children:l.title.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold text-slate-700 dark:text-slate-400",children:"Author"}),e.jsx("input",{...t("author_name"),className:"mt-2 w-full rounded-lg border border-slate-300 bg-white px-4 py-2 text-sm text-slate-900 placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-brand-500 dark:border-white/10 dark:bg-slate-900 dark:text-white"}),l.author_name&&e.jsx("p",{className:"text-xs text-red-400",children:l.author_name.message})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold text-slate-700 dark:text-slate-400",children:"Description"}),e.jsx("textarea",{...t("description"),rows:4,className:"mt-2 w-full rounded-lg border border-slate-300 bg-white px-4 py-2 text-sm text-slate-900 placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-brand-500 dark:border-white/10 dark:bg-slate-900 dark:text-white"}),l.description&&e.jsx("p",{className:"text-xs text-red-400",children:l.description.message})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold text-slate-700 dark:text-slate-400",children:"ISBN"}),e.jsx("input",{...t("isbn"),className:"mt-2 w-full rounded-lg border border-slate-300 bg-white px-4 py-2 text-sm text-slate-900 placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-brand-500 dark:border-white/10 dark:bg-slate-900 dark:text-white"}),l.isbn&&e.jsx("p",{className:"text-xs text-red-400",children:l.isbn.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold text-slate-700 dark:text-slate-400",children:"Language"}),e.jsx("input",{...t("language"),className:"mt-2 w-full rounded-lg border border-slate-300 bg-white px-4 py-2 text-sm text-slate-900 placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-brand-500 dark:border-white/10 dark:bg-slate-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold text-slate-700 dark:text-slate-400",children:"Year"}),e.jsx("input",{type:"number",...t("year"),className:"mt-2 w-full rounded-lg border border-slate-300 bg-white px-4 py-2 text-sm text-slate-900 placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-brand-500 dark:border-white/10 dark:bg-slate-900 dark:text-white"})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold text-slate-700 dark:text-slate-400",children:"Pages"}),e.jsx("input",{type:"number",...t("pages"),className:"mt-2 w-full rounded-lg border border-slate-300 bg-white px-4 py-2 text-sm text-slate-900 placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-brand-500 dark:border-white/10 dark:bg-slate-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold text-slate-700 dark:text-slate-400",children:"File Type"}),e.jsxs("select",{...t("file_type"),className:"mt-2 w-full rounded-lg border border-slate-300 bg-white px-4 py-2 text-sm text-slate-900 focus:outline-none focus:ring-2 focus:ring-brand-500 dark:border-white/10 dark:bg-slate-900 dark:text-white",children:[e.jsx("option",{value:"PDF",children:"PDF"}),e.jsx("option",{value:"EPUB",children:"EPUB"}),e.jsx("option",{value:"VIDEO",children:"Video"})]})]}),e.jsxs("label",{className:"flex items-center gap-2 text-xs font-semibold text-slate-700 dark:text-slate-400",children:[e.jsx("input",{type:"checkbox",...t("is_published"),className:"h-4 w-4"}),"Published"]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold text-slate-700 dark:text-slate-400",children:"Tags (comma separated)"}),e.jsx("input",{...t("tags"),className:"mt-2 w-full rounded-lg border border-slate-300 bg-white px-4 py-2 text-sm text-slate-900 placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-brand-500 dark:border-white/10 dark:bg-slate-900 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold text-slate-700 dark:text-slate-400",children:"Categories (comma separated)"}),e.jsx("input",{...t("category_names"),className:"mt-2 w-full rounded-lg border border-slate-300 bg-white px-4 py-2 text-sm text-slate-900 placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-brand-500 dark:border-white/10 dark:bg-slate-900 dark:text-white"})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold text-slate-700 dark:text-slate-400",children:"Cover Image"}),e.jsx("input",{type:"file",accept:"image/*",...t("cover_image"),className:"mt-2 block w-full text-sm text-slate-600 dark:text-slate-200"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-semibold text-slate-700 dark:text-slate-400",children:"Book File"}),e.jsx("input",{type:"file",accept:h("file_type")==="VIDEO"?"video/*":".pdf,.epub",...t("file"),className:"mt-2 block w-full text-sm text-slate-600 dark:text-slate-200"})]})]}),e.jsx("button",{type:"submit",className:"btn-primary text-sm",disabled:b,children:b?"Savingâ€¦":"Save Book"})]})},$=()=>{const s=N(),[m,b]=f.useState(""),[t,c]=f.useState(null),{data:h,isPending:l}=_({queryKey:["admin-books",m],queryFn:()=>F({page:1,ordering:"-created_at",query:m}),staleTime:2*60*1e3}),p=g({mutationFn:a=>E(a),onSuccess:()=>{x.success("Book created"),s.invalidateQueries({queryKey:["admin-books"]}),c(null)},onError:()=>x.error("Failed to create book")}),u=g({mutationFn:({id:a,formData:w})=>S(a,w),onSuccess:()=>{x.success("Book updated"),s.invalidateQueries({queryKey:["admin-books"]}),c(null)},onError:()=>x.error("Failed to update book")}),n=g({mutationFn:a=>B(a),onSuccess:()=>{x.success("Book deleted"),s.invalidateQueries({queryKey:["admin-books"]})},onError:()=>x.error("Failed to delete book")}),d=a=>{t?u.mutate({id:t.id,formData:a}):p.mutate(a)},r=a=>{c(a),window.scrollTo({top:0,behavior:"smooth"})},i=()=>{c(null)};return e.jsx("div",{className:"space-y-10",children:e.jsxs("div",{className:"grid gap-10 lg:grid-cols-[1.1fr_0.9fr]",children:[e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h1",{className:"text-2xl font-semibold text-slate-900 dark:text-white",children:"Manage books"})}),e.jsxs("div",{className:"mt-6 relative",children:[e.jsx(A,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-slate-400"}),e.jsx("input",{type:"text",placeholder:"Search books by title, author, or description...",value:m,onChange:a=>b(a.target.value),className:"w-full rounded-xl border border-slate-200 bg-white py-2 pl-10 pr-4 text-sm text-slate-900 placeholder:text-slate-400 focus:border-brand-500 focus:outline-none focus:ring-1 focus:ring-brand-500 dark:border-white/10 dark:bg-white/5 dark:text-white"})]}),l?e.jsx(v,{label:"Loading books"}):e.jsx("div",{className:"mt-6 space-y-4",children:h?.results.map(a=>e.jsxs("div",{className:`rounded-2xl border p-4 transition ${t?.id===a.id?"border-brand-500 bg-brand-50 dark:bg-brand-500/10":"border-slate-200 bg-white hover:bg-slate-50 dark:border-white/10 dark:bg-slate-900/40"}`,children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.3em] text-slate-500 dark:text-brand-200",children:a.author}),e.jsx("h3",{className:"text-base font-semibold text-slate-900 dark:text-white",children:a.title}),e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:a.is_published?"Published":"Draft"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>r(a),className:"flex items-center gap-1 text-xs text-brand-400 hover:text-brand-300",children:[e.jsx(Q,{className:"h-3 w-3"}),"Edit"]}),e.jsx("button",{onClick:()=>n.mutate(a.id),className:"text-xs text-red-400 hover:text-red-300",disabled:n.isPending,children:"Remove"})]})]}),e.jsx("p",{className:"mt-2 line-clamp-2 text-sm text-slate-600 dark:text-slate-400",children:a.description})]},a.id))})]}),e.jsxs("div",{className:"card p-5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-900 dark:text-white",children:t?"Edit Book":"Create Book"}),e.jsx("p",{className:"text-xs text-slate-600 dark:text-slate-500",children:t?`Editing: ${t.title} `:"Add a new book to the library"})]}),t&&e.jsx("button",{onClick:i,className:"text-xs text-slate-400 hover:text-white",children:"Cancel"})]}),e.jsx("div",{className:"mt-4",children:e.jsx(O,{defaultValues:t?{title:t.title,author_name:t.author,description:t.description,isbn:t.isbn||"",language:t.language,year:t.year,pages:t.pages,file_type:t.file_type,is_published:t.is_published,tags:t.tags||[],category_names:t.categories?.map(a=>a.name)}:void 0,onSubmit:d,isLoading:p.isPending||u.isPending},t?.id||"new")})]})]})})};export{$ as default};
