import{b as y,j as e,L as N}from"./index-JCKDIzil.js";import{r as o}from"./react-vendor-BXWpoY3z.js";import{u as T}from"./useQuery-CRcodGZg.js";import{S as m}from"./StatCard-CrotQOgq.js";import{R as x,T as h,C as _,p as C,B as S}from"./generateCategoricalChart-BIqcnmrS.js";import{L as R,a as P}from"./LineChart-blhS04xT.js";import{C as p,X as b,Y as u,B as L}from"./BarChart-D7jnTnPj.js";import{P as M,a as B}from"./PieChart-Camb4-vU.js";import"./ui-vendor-LNFcJBPj.js";import"./tiny-invariant-CopsF_GD.js";const O=async(i="month",n="month",l="month",d="month")=>{const{data:r}=await y.get("/analytics/admin/overview/",{params:{reads_period:i,liked_period:n,search_period:l,viewed_period:d}});return r},j=["#3b82f6","#10b981","#f59e0b","#8b5cf6","#f43f5e"],f={today:"Today",week:"This Week",month:"This Month",year:"This Year"},H=()=>{const[i,n]=o.useState("month"),[l,d]=o.useState("month"),[r,k]=o.useState("month"),[c,v]=o.useState("month"),{data:s,isPending:g,refetch:W}=T({queryKey:["admin-overview",r,l,i,c],queryFn:()=>O(r,l,i,c),staleTime:2*60*1e3});if(g||!s)return e.jsx(N,{label:"Fetching analytics"});const w=s.reads_per_day||[];return e.jsxs("div",{className:"space-y-8 animate-in",children:[e.jsxs("div",{className:"page-header",children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.4em] text-brand-600 dark:text-brand-400",children:"Admin"}),e.jsx("h1",{className:"page-title",children:"Analytics Overview"}),e.jsx("p",{className:"page-subtitle",children:"Monitor library performance and user engagement"})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-3",children:[e.jsx(m,{variant:"blue",label:"Total Books",value:s.overview.total_books,hint:"In library"}),e.jsx(m,{variant:"emerald",label:"Active Readers",value:s.overview.total_users,icon:e.jsx("svg",{className:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"})}),hint:"Registered users"}),e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"card p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wide",children:"Total Reads"}),e.jsx("span",{className:"rounded-full bg-slate-100 px-2 py-0.5 text-[10px] font-bold text-slate-600 dark:bg-slate-800 dark:text-slate-400",children:f[r]})]}),e.jsx("p",{className:"text-3xl font-bold text-violet-600 dark:text-violet-400",children:s.overview.total_reads_period||s.overview.total_reads}),e.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-400 mt-1",children:["Book opens (",f[r],")"]})]}),e.jsxs("div",{className:"absolute top-2 right-12 group",children:[e.jsx("svg",{className:"h-4 w-4 text-slate-400 cursor-help",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("div",{className:"absolute right-0 top-6 z-10 hidden group-hover:block w-48 p-2 rounded-lg bg-slate-900 text-white text-xs shadow-lg",children:"Each time a user opens a book to read it, it counts as 1 read."})]})]})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900 dark:text-white",children:"Reading Activity"}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:r==="today"?"Hourly reads today":`Daily reads over the last ${r}`})]}),e.jsxs("select",{value:r,onChange:t=>k(t.target.value),className:"rounded-lg border border-slate-200 bg-white px-3 py-1.5 text-xs font-medium text-slate-700 dark:border-white/10 dark:bg-slate-800 dark:text-white",children:[e.jsx("option",{value:"today",children:"Today"}),e.jsx("option",{value:"week",children:"This Week"}),e.jsx("option",{value:"month",children:"This Month"}),e.jsx("option",{value:"year",children:"This Year"})]})]}),e.jsx("div",{className:"h-64",children:e.jsx(x,{width:"100%",height:"100%",children:e.jsxs(R,{data:w,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorReads",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#3b82f6",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"#3b82f6",stopOpacity:0})]})}),e.jsx(p,{strokeDasharray:"3 3",stroke:"#e2e8f0",opacity:.5}),e.jsx(b,{dataKey:"date",hide:!0,stroke:"#64748b"}),e.jsx(u,{stroke:"#64748b",allowDecimals:!1,tick:{fill:"#64748b",fontSize:12}}),e.jsx(h,{contentStyle:{background:"white",border:"1px solid #e2e8f0",borderRadius:"12px",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)"},labelStyle:{color:"#1e293b",fontWeight:600}}),e.jsx(P,{type:"monotone",dataKey:"count",stroke:"#3b82f6",strokeWidth:3,dot:{fill:"#3b82f6",r:4},activeDot:{r:6},fill:"url(#colorReads)"})]})})})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900 dark:text-white",children:"Popular Categories"}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Most liked book categories"})]}),e.jsxs("select",{value:l,onChange:t=>d(t.target.value),className:"rounded-lg border border-slate-200 bg-white px-3 py-1.5 text-xs font-medium text-slate-700 dark:border-white/10 dark:bg-slate-800 dark:text-white",children:[e.jsx("option",{value:"today",children:"Today"}),e.jsx("option",{value:"week",children:"This Week"}),e.jsx("option",{value:"month",children:"This Month"})]})]}),e.jsx("div",{className:"h-64",children:e.jsx(x,{width:"100%",height:"100%",children:e.jsxs(M,{children:[e.jsx(B,{data:s.most_liked_categories,cx:"50%",cy:"50%",innerRadius:60,outerRadius:90,paddingAngle:5,dataKey:"likes",nameKey:"name",label:({name:t,percent:a})=>`${t}: ${(a*100).toFixed(0)}%`,labelLine:{stroke:"#64748b"},children:s.most_liked_categories.map((t,a)=>e.jsx(_,{fill:j[a%j.length]},`cell-${a}`))}),e.jsx(h,{contentStyle:{background:"white",border:"1px solid #e2e8f0",borderRadius:"12px",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)"}}),e.jsx(C,{wrapperStyle:{fontSize:"12px"},iconType:"circle"})]})})})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900 dark:text-white",children:"Peak Usage Times"}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Book opens by hour of day (shows when users are most active)"})]}),e.jsx("div",{className:"h-64",children:e.jsx(x,{width:"100%",height:"100%",children:e.jsxs(L,{data:s.reads_per_hour,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorBar",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:"#f59e0b",stopOpacity:1}),e.jsx("stop",{offset:"100%",stopColor:"#f59e0b",stopOpacity:.7})]})}),e.jsx(p,{strokeDasharray:"3 3",stroke:"#e2e8f0",opacity:.5}),e.jsx(b,{dataKey:"hour",stroke:"#64748b",tick:{fill:"#64748b",fontSize:12},tickFormatter:t=>`${t}:00`}),e.jsx(u,{stroke:"#64748b",allowDecimals:!1,tick:{fill:"#64748b",fontSize:12}}),e.jsx(h,{contentStyle:{background:"white",border:"1px solid #e2e8f0",borderRadius:"12px",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)"},labelStyle:{color:"#1e293b",fontWeight:600},labelFormatter:t=>`${t}:00 - ${t+1}:00`,formatter:t=>[`${t} opens`,"Book Opens"]}),e.jsx(S,{dataKey:"count",fill:"url(#colorBar)",radius:[8,8,0,0]})]})})})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-3",children:[e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsx("h3",{className:"text-xl font-bold text-slate-900 dark:text-white",children:"Most Viewed Books"}),e.jsxs("select",{value:c,onChange:t=>v(t.target.value),className:"rounded-lg border border-slate-200 bg-white px-2 py-1 text-xs font-medium text-slate-700 dark:border-white/10 dark:bg-slate-800 dark:text-white",children:[e.jsx("option",{value:"today",children:"Today"}),e.jsx("option",{value:"week",children:"This Week"}),e.jsx("option",{value:"month",children:"This Month"})]})]}),e.jsx("ul",{className:"space-y-3",children:s.most_read_books?.slice(0,6).map((t,a)=>e.jsxs("li",{className:"flex items-center justify-between rounded-xl border border-slate-200 bg-slate-50 p-3 transition-colors hover:bg-slate-100 dark:border-white/5 dark:bg-slate-800/50 dark:hover:bg-slate-800",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-7 w-7 items-center justify-center rounded-full bg-gradient-to-br from-blue-500 to-blue-600 text-xs font-bold text-white",children:a+1}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-sm font-semibold text-slate-900 dark:text-white truncate",children:t.title}),e.jsx("p",{className:"text-xs text-slate-600 dark:text-slate-400",children:t.author})]})]}),e.jsxs("span",{className:"rounded-full bg-blue-100 px-2 py-1 text-xs font-semibold text-blue-700 dark:bg-blue-500/20 dark:text-blue-300 shrink-0",children:[t.view_count," views"]})]},t.id))})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsx("h3",{className:"text-xl font-bold text-slate-900 dark:text-white",children:"Most Liked Books"}),e.jsxs("select",{value:l,onChange:t=>d(t.target.value),className:"rounded-lg border border-slate-200 bg-white px-2 py-1 text-xs font-medium text-slate-700 dark:border-white/10 dark:bg-slate-800 dark:text-white",children:[e.jsx("option",{value:"today",children:"Today"}),e.jsx("option",{value:"week",children:"This Week"}),e.jsx("option",{value:"month",children:"This Month"})]})]}),e.jsx("ul",{className:"space-y-3",children:(s.most_liked_books?.length>0?s.most_liked_books:[]).slice(0,6).map((t,a)=>e.jsxs("li",{className:"flex items-center justify-between rounded-xl border border-slate-200 bg-slate-50 p-3 transition-colors hover:bg-slate-100 dark:border-white/5 dark:bg-slate-800/50 dark:hover:bg-slate-800",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-7 w-7 items-center justify-center rounded-full bg-gradient-to-br from-rose-500 to-pink-600 text-xs font-bold text-white",children:a+1}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-sm font-semibold text-slate-900 dark:text-white truncate",children:t.title}),e.jsx("p",{className:"text-xs text-slate-600 dark:text-slate-400",children:t.author})]})]}),e.jsxs("span",{className:"rounded-full bg-rose-100 px-2 py-1 text-xs font-semibold text-rose-700 dark:bg-rose-500/20 dark:text-rose-300 shrink-0",children:[t.like_count||0," likes"]})]},t.id))})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsx("h3",{className:"text-xl font-bold text-slate-900 dark:text-white",children:"Top Search Terms"}),e.jsxs("select",{value:i,onChange:t=>n(t.target.value),className:"rounded-lg border border-slate-200 bg-white px-2 py-1 text-xs font-medium text-slate-700 dark:border-white/10 dark:bg-slate-800 dark:text-white",children:[e.jsx("option",{value:"today",children:"Today"}),e.jsx("option",{value:"week",children:"This Week"}),e.jsx("option",{value:"month",children:"This Month"})]})]}),e.jsx("ul",{className:"space-y-3",children:s.top_search_terms?.slice(0,6).map((t,a)=>e.jsxs("li",{className:"flex items-center justify-between rounded-xl border border-slate-200 bg-slate-50 p-3 transition-colors hover:bg-slate-100 dark:border-white/5 dark:bg-slate-800/50 dark:hover:bg-slate-800",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-7 w-7 items-center justify-center rounded-full bg-gradient-to-br from-emerald-500 to-emerald-600 text-xs font-bold text-white",children:a+1}),e.jsxs("span",{className:"text-sm font-medium text-slate-900 dark:text-white",children:["#",t.term]})]}),e.jsxs("span",{className:"rounded-full bg-emerald-100 px-2 py-1 text-xs font-semibold text-emerald-700 dark:bg-emerald-500/20 dark:text-emerald-300 shrink-0",children:[t.count," searches"]})]},t.term))})]})]})]})};export{H as default};
