import{j as e,z as d}from"./index-C_R6iRdk.js";import{h as A,e as E,r as l,L as V}from"./react-vendor-BXWpoY3z.js";import{u as D}from"./useQuery-DjejrF76.js";import{u as F}from"./useMutation-Com-Be19.js";import{c as M,a as T}from"./subscriptions-D2v3T0Hl.js";import{d as q,q as I,c as Y,p as z,r as g}from"./ui-vendor-DTvEXM4H.js";const K=()=>{const{planId:i}=A(),f=E(),[m,y]=l.useState(""),[x,j]=l.useState(""),[u,N]=l.useState(""),[k,v]=l.useState(""),[s,o]=l.useState("input"),{data:p}=D({queryKey:["subscription-plans"],queryFn:T,staleTime:5*60*1e3,gcTime:10*60*1e3}),a=(Array.isArray(p)?p:[]).find(t=>t.id===Number(i)),w=F({mutationFn:M,onSuccess:()=>{o("success"),setTimeout(()=>f("/"),3e3)},onError:()=>{d.error("Payment failed. Please check your card details."),o("input")}}),C=t=>{const b=t.replace(/\s+/g,"").replace(/[^0-9]/gi,"").match(/\d{4,16}/g),h=b&&b[0]||"",c=[];for(let n=0,L=h.length;n<L;n+=4)c.push(h.substring(n,n+4));return c.length?c.join(" "):t},S=t=>{const r=t.replace(/\D/g,"");return r.length>=2?r.substring(0,2)+"/"+r.substring(2,4):r},P=t=>{if(t.preventDefault(),m.replace(/\s/g,"").length<16){d.error("Please enter a valid card number");return}if(x.length<5){d.error("Please enter a valid expiry date");return}if(u.length<3){d.error("Please enter a valid CVV");return}o("processing"),setTimeout(()=>{w.mutate({plan_id:Number(i),payment_method:"VISA"})},2e3)};return s==="success"?e.jsxs("div",{className:"mx-auto max-w-md py-16 text-center animate-in",children:[e.jsx("div",{className:"mx-auto mb-6 flex h-20 w-20 items-center justify-center rounded-full bg-emerald-100 dark:bg-emerald-500/20",children:e.jsx(q,{className:"h-10 w-10 text-emerald-600 dark:text-emerald-400"})}),e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:"Payment Successful!"}),e.jsxs("p",{className:"mt-2 text-slate-600 dark:text-slate-400",children:["Your ",a?.name," subscription is now active. Redirecting..."]})]}):e.jsxs("div",{className:"mx-auto max-w-md space-y-6 py-8 animate-in",children:[e.jsxs(V,{to:`/subscription/payment/${i}`,className:"inline-flex items-center gap-2 text-sm font-medium text-slate-600 hover:text-brand-600 dark:text-slate-400",children:[e.jsx(I,{className:"h-4 w-4"}),"Back to payment options"]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-2xl bg-gradient-to-br from-blue-500 to-blue-600",children:e.jsx(Y,{className:"h-8 w-8 text-white"})}),e.jsx("h1",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:"Card Payment"}),e.jsxs("p",{className:"mt-2 text-slate-600 dark:text-slate-400",children:["Pay UGX ",a?Number(a.price).toLocaleString():"---"," for ",a?.name]})]}),e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx("div",{className:"rounded-lg border border-slate-200 bg-white px-3 py-2 dark:border-white/10 dark:bg-slate-800",children:e.jsx("span",{className:"text-xs font-bold text-blue-600",children:"VISA"})}),e.jsx("div",{className:"rounded-lg border border-slate-200 bg-white px-3 py-2 dark:border-white/10 dark:bg-slate-800",children:e.jsx("span",{className:"text-xs font-bold text-orange-500",children:"MC"})})]}),e.jsxs("form",{onSubmit:P,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Cardholder Name"}),e.jsx("input",{type:"text",value:k,onChange:t=>v(t.target.value),placeholder:"John Doe",disabled:s==="processing",className:"w-full rounded-xl border border-slate-300 px-4 py-3 text-slate-900 placeholder:text-slate-400 focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20 dark:border-white/10 dark:bg-slate-900 dark:text-white disabled:opacity-50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Card Number"}),e.jsx("input",{type:"text",value:m,onChange:t=>y(C(t.target.value)),placeholder:"4242 4242 4242 4242",maxLength:19,disabled:s==="processing",className:"w-full rounded-xl border border-slate-300 px-4 py-3 text-slate-900 placeholder:text-slate-400 focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20 dark:border-white/10 dark:bg-slate-900 dark:text-white disabled:opacity-50"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Expiry Date"}),e.jsx("input",{type:"text",value:x,onChange:t=>j(S(t.target.value)),placeholder:"MM/YY",maxLength:5,disabled:s==="processing",className:"w-full rounded-xl border border-slate-300 px-4 py-3 text-slate-900 placeholder:text-slate-400 focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20 dark:border-white/10 dark:bg-slate-900 dark:text-white disabled:opacity-50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"CVV"}),e.jsx("input",{type:"password",value:u,onChange:t=>N(t.target.value.replace(/\D/g,"").slice(0,4)),placeholder:"•••",maxLength:4,disabled:s==="processing",className:"w-full rounded-xl border border-slate-300 px-4 py-3 text-slate-900 placeholder:text-slate-400 focus:border-brand-500 focus:outline-none focus:ring-2 focus:ring-brand-500/20 dark:border-white/10 dark:bg-slate-900 dark:text-white disabled:opacity-50"})]})]}),e.jsx("button",{type:"submit",disabled:s==="processing",className:"w-full rounded-xl bg-gradient-to-r from-blue-500 to-blue-600 py-3 font-semibold text-white shadow-lg transition hover:shadow-xl disabled:opacity-50 flex items-center justify-center gap-2",children:s==="processing"?e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"h-5 w-5 animate-spin"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(g,{className:"h-4 w-4"}),"Pay UGX ",a?Number(a.price).toLocaleString():"---"]})})]}),e.jsxs("p",{className:"text-center text-xs text-slate-500 dark:text-slate-400 flex items-center justify-center gap-1",children:[e.jsx(g,{className:"h-3 w-3"}),"Secured by SSL encryption"]})]})};export{K as default};
