import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import { useQuery } from '@tanstack/react-query';
import { useNavigate } from 'react-router-dom';
import { PieChart, Pie, Cell, ResponsiveContainer, Tooltip, Legend } from 'recharts';
import { getUserAnalytics } from '../../../lib/api/reading';
import LoadingOverlay from '../../../components/feedback/LoadingOverlay';
const COLORS = ['#8b5cf6', '#3b82f6', '#10b981', '#f59e0b', '#ef4444', '#ec4899'];
const AnalyticsCompletionPage = () => {
    const navigate = useNavigate();
    const { data, isLoading } = useQuery({
        queryKey: ['analytics'],
        queryFn: () => getUserAnalytics(),
        staleTime: 5 * 60 * 1000,
    });
    if (isLoading) {
        return _jsx(LoadingOverlay, { label: "Loading completion stats" });
    }
    const stats = data?.completion_stats || { rate: 0, total: 0, completed: 0, by_category: [] };
    const categoryData = stats.by_category || [];
    return (_jsxs("div", { className: "space-y-8 animate-in", children: [_jsxs("div", { className: "flex items-center gap-4", children: [_jsx("button", { onClick: () => navigate('/dashboard'), className: "rounded-full p-2 hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors", children: _jsx("svg", { className: "h-6 w-6 text-slate-600 dark:text-slate-400", fill: "none", stroke: "currentColor", viewBox: "0 0 24 24", children: _jsx("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M10 19l-7-7m0 0l7-7m-7 7h18" }) }) }), _jsxs("div", { children: [_jsx("p", { className: "text-xs font-semibold uppercase tracking-[0.4em] text-brand-600 dark:text-brand-400", children: "Analytics" }), _jsx("h1", { className: "text-3xl font-bold text-slate-900 dark:text-white", children: "Completion Rate" })] })] }), _jsxs("div", { className: "card p-8 text-center bg-gradient-to-br from-cyan-500 to-blue-600 text-white border-none", children: [_jsxs("h2", { className: "text-5xl font-bold mb-2", children: [stats.rate, "%"] }), _jsx("p", { className: "text-cyan-100 text-lg", children: "Books Completed" }), _jsxs("div", { className: "mt-6 flex justify-center gap-8", children: [_jsxs("div", { children: [_jsx("p", { className: "text-2xl font-bold", children: stats.completed }), _jsx("p", { className: "text-sm text-cyan-100", children: "Finished" })] }), _jsx("div", { className: "h-12 w-px bg-white/20" }), _jsxs("div", { children: [_jsx("p", { className: "text-2xl font-bold", children: stats.total }), _jsx("p", { className: "text-sm text-cyan-100", children: "Total Started" })] })] })] }), _jsxs("div", { className: "grid gap-6 lg:grid-cols-2", children: [_jsxs("div", { className: "card p-6", children: [_jsx("h3", { className: "text-lg font-bold text-slate-900 dark:text-white mb-4", children: "What is Completion Rate?" }), _jsx("p", { className: "text-slate-600 dark:text-slate-400 leading-relaxed", children: "Your completion rate measures the percentage of books you've finished out of all the books you've started reading." }), _jsxs("div", { className: "mt-4 space-y-3", children: [_jsxs("div", { className: "flex items-start gap-3", children: [_jsx("div", { className: "mt-1 rounded-full bg-emerald-100 p-1 dark:bg-emerald-900/30", children: _jsx("svg", { className: "h-4 w-4 text-emerald-600 dark:text-emerald-400", fill: "none", stroke: "currentColor", viewBox: "0 0 24 24", children: _jsx("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M5 13l4 4L19 7" }) }) }), _jsxs("p", { className: "text-sm text-slate-600 dark:text-slate-400", children: [_jsx("span", { className: "font-medium text-slate-900 dark:text-white", children: "High Rate (>80%):" }), " You're a focused reader who finishes what they start."] })] }), _jsxs("div", { className: "flex items-start gap-3", children: [_jsx("div", { className: "mt-1 rounded-full bg-amber-100 p-1 dark:bg-amber-900/30", children: _jsx("svg", { className: "h-4 w-4 text-amber-600 dark:text-amber-400", fill: "none", stroke: "currentColor", viewBox: "0 0 24 24", children: _jsx("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" }) }) }), _jsxs("p", { className: "text-sm text-slate-600 dark:text-slate-400", children: [_jsx("span", { className: "font-medium text-slate-900 dark:text-white", children: "Low Rate (<30%):" }), " You enjoy exploring many books before committing to one."] })] })] })] }), _jsxs("div", { className: "card p-6", children: [_jsx("h3", { className: "text-lg font-bold text-slate-900 dark:text-white mb-4", children: "Completed by Category" }), categoryData.length > 0 ? (_jsx("div", { className: "h-[300px] w-full", children: _jsx(ResponsiveContainer, { width: "100%", height: "100%", children: _jsxs(PieChart, { children: [_jsx(Pie, { data: categoryData, cx: "50%", cy: "50%", innerRadius: 60, outerRadius: 80, paddingAngle: 5, dataKey: "value", children: categoryData.map((entry, index) => (_jsx(Cell, { fill: COLORS[index % COLORS.length] }, `cell-${index}`))) }), _jsx(Tooltip, { contentStyle: { backgroundColor: '#1e293b', border: 'none', borderRadius: '8px', color: '#fff' }, itemStyle: { color: '#fff' } }), _jsx(Legend, { verticalAlign: "bottom", height: 36 })] }) }) })) : (_jsx("div", { className: "flex h-[300px] items-center justify-center text-center", children: _jsx("p", { className: "text-slate-500 dark:text-slate-400", children: "No category data available yet." }) }))] })] })] }));
};
export default AnalyticsCompletionPage;
